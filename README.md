# EveryAction Tools

Programs for membership migration and contact management with EveryAction

 * `sync_activists.py` - Syncs an Action Network export with EveryAction database
 * `count_tags.py` - Returns count of csv records wih Action Network tags

## Getting Started

### Installing Python

These scripts have been developed with Python 3.10. You can download Python at https://www.python.org/downloads/.

### Generate API Key

An API Key is a secret token used to identify and authenticate who is running the Python script.

To generate an API Key first "Request an API Key" from through the [API Integrations](https://www.targetsmartvan.com/APIIntegrations.aspx#/) page. For example,

    Integration: Action Network
    Request will be sent to: Evan

Once approved the API Key will appear on the same page with the button "Generate API Key".
Record following information:

    Application Name:                   TSURJ.99.99
    One-Time Action Network API Key:    d9999f51-8564-5341-145g-g615d99999af

The API Key is only visible one-time. Copy it and secure it like you would a password.

### Install Packages

Install the EveryAction
[Python Client for EveryAction](https://partiallyderived.github.io/everyaction-client/) and other required packages

    pip install -r requirements.txt

## Sync Activists

The sync_activists script reads a csv file of ActionNetwork activits and synchronizes them with
contacts in an Every Action database. The script looks for column names as generated by
ActionNetwork from an activist export. For example,

    first_name,last_name,email,can2_subscription_status,can2_user_tags
    jo,smyth,jo.smyth@email.com,unsubscribed,"#White Supremacy, $Donor - 12 days"

The script can be run like this.

    python sync_activists.py an_export.csv

The script creates a log file an_export.csv.log of actions taken. For example,

    SyncFile: 'an_export.csv'
    [0001] OK jo.smyth@email.com [unsubscribed]

When the script is run again it can use the log file to skip over previously
successful syncs.

    python sync_activists.py --resume an_export.csv

## Columns

The sync_activists.py script syncs data from these special columns. Other columns are ignored. Only `email` is required:
 * `email`
 * `uuid` - If present warns if it does not match ExternalId of type ActionNetworkId if one is found
 * `can2_subscription_status` - If present will update subscription status in EveryAction
 * `can2_user_tags` - Tag names separated by ", "
 * `first_name`
 * `last_name`
 * `zip_code`
 * `can2_user_address`
 * `can2_user_city`
 * `can2_state_abbreviated`
 * `zip_code`
 * `country`
 * `can2_phone` - special mobile phone number
 * `can2_sms_status` - indicates if mobile phone has been opted in.
 * `Phone` - custom field
 * `Phone Number` - another custom field

## Options

    usage: sync_activists.py [-h] [--env dotenv_file] [--start N] [--end N | --count N] [--verbose] [--update] [--dryrun] [--log LOGFILENAME] [--resume] [--overwrite] [inputFile]

    Sync activists from a CSV export

    positional arguments:
    inputFile             Importable CSV file

    options:
    -h, --help            show this help message and exit
    --env dotenv_file, -g dotenv_file
                            Environment File with API Key.
    --start N, -s N       First row to process (starting at 1)
    --end N, -e N         Last row to process
    --count N, -c N       Number of rows to process
    --verbose, -v         Show data
    --update, -u          Update existing contacts (name, address etc.)
    --dryrun, -d          Indicate what would happen but don't send to EveryAction
    --log LOGFILENAME, -l LOGFILENAME
                            Defaults to name of input file with .log extension. Use '-' for console.
    --resume              Resume importing imports (as per existing file)
    --overwrite           Overwrite existing log file
